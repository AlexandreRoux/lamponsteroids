# Create database backup user and grand him permissions to database for backup
#
- name: Create user for backups
  mysql_user:
    login_user: root
    login_password: "{{ mysql_root_password }}"
    name: "{{ mysql_backup_user }}"
    password: "{{ mysql_backup_user_password }}"
    state: present
    priv: "{{ mysql_backup_databases|map(attribute='database') | map('regex_replace', '(.*)', '\\1.*:SELECT') | join('/') }}"
  tags: [mysql, backup]



# Create .my.cnf file with backup user database credentials
#
- name: Create .my.cnf with database backup user credentials
  template:
    src: my.cnf.j2
    dest: "/root/.my.cnf"
    owner: root
    group: root
    mode: 0600
  tags: [mysql, backup]
