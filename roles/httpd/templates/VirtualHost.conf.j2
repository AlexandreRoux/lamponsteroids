<VirtualHost *:{{ httpd_port }}>

    ServerName {{ item.ServerName }}
    {% if item.ServerAlias is defined %}
    ServerAlias {{ item.ServerAlias }}
    {% endif %}

    # Directory settings
    DocumentRoot {{ httpd_websites_directory }}/{{ item.ServerName }}/htdocs
    <Directory {{ httpd_websites_directory }}/{{ item.ServerName }}/htdocs>
        AllowOverride All
        Require all granted
        Options +FollowSymLinks -Indexes -Includes
    </Directory>

    {% if item.PhpFpm is defined %}
    # PHP-FPM settings
    ProxyPassMatch "^/(.*\.php(/.*)?)$" "fcgi://127.0.0.1:{{ item.PhpFpm.port }}{{ httpd_websites_directory }}/{{ item.ServerName }}/htdocs"
    {% endif %}

    # Logging
    ErrorLog "{{ httpd_websites_directory }}/{{ item.ServerName }}/logs/httpd-error.log"
    CustomLog "{{ httpd_websites_directory }}/{{ item.ServerName }}/logs/httpd-access.log" common

</VirtualHost>
